import chalk from 'chalk';
import esbuild from 'esbuild';
import { readPackageUpSync } from 'read-pkg-up';
const pkg = readPackageUpSync()?.packageJson;
const args = process.argv.slice(2);
esbuild
    .build({
    entryPoints: ['src/index.ts'],
    bundle: true,
    outfile: 'bin/index.js',
    platform: 'node',
    format: 'esm',
    target: 'es2020',
    external: [
        ...Object.keys(pkg?.dependencies || {}),
        ...Object.keys(pkg?.peerDependencies || {}),
    ],
    watch: args.includes('-w')
        ? {
            onRebuild: () => {
                console.log(chalk.hex('#459AD4')('rebuilding @wedgekit/scripts'));
            },
        }
        : false,
})
    .then(() => {
    console.log(chalk.hex('#1D9C66')('@wedgekit/scripts built'));
})
    .catch(() => {
    console.log(chalk.hex('#D63B20')('⚠️ @wedgekit/scripts build failed'));
});
