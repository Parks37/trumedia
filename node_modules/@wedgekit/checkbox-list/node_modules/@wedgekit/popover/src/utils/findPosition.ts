import { setProperty as set } from 'dot-prop';

import type { Bearings, Position } from '../Popover';

export const DEFAULT_OFFSET = 16;

const findPosition = (anchor: DOMRect, floater: DOMRect, bearings?: Bearings): Position => {
  const position: Position = {};

  const offset = bearings?.offset || DEFAULT_OFFSET;

  if (bearings?.side === 'left' || bearings?.side === 'right') {
    if (bearings?.side === 'left') {
      set(position, 'left', anchor.left - floater.width - offset);
    } else {
      set(position, 'left', anchor.right + offset);
    }

    if (bearings?.align === 'end') {
      set(position, 'top', anchor.bottom - floater.height);
    } else if (bearings?.align === 'center') {
      set(position, 'top', anchor.top + (anchor.height / 2 - floater.height / 2));
    } else {
      set(position, 'top', anchor.top);
    }
  } else {
    if (bearings?.side === 'top') {
      set(position, 'top', anchor.top - floater.height - offset);
    } else {
      set(position, 'top', anchor.bottom + offset);
    }

    if (bearings?.align === 'end') {
      set(position, 'left', anchor.right - floater.width);
    } else if (bearings?.align === 'center') {
      set(position, 'left', anchor.left + (anchor.width / 2 - floater.width / 2));
    } else {
      set(position, 'left', anchor.left);
    }
  }

  return position;
};

export default findPosition;
