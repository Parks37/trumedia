import L,{useEffect as R,useImperativeHandle as V,useRef as T,useState as C}from"react";import F from"styled-components";import{handleKeyEvent as S}from"@wedgekit/utils";import $ from"@wedgekit/checkbox";import{Label as U,getBasePx as W}from"@wedgekit/primitives";var A=({allowMultiple:i=!0,options:u,filteredOptions:p=u,currentIdx:a,previousIdx:t,shiftDown:w,value:s})=>{if(!i)return[p[a].id];let[v,f]=[a,t].sort();return u.reduce((l,r)=>{let b=s.includes(r.id),d=p.findIndex(m=>m.id===r.id);if(typeof d!="number")return b?l.concat(r.id):l;if(w){let m=v<=d&&d<=f;if(b||m)return l.concat(r.id)}let n=a===d;return(b||n)&&!(b&&n)?l.concat(r.id):l},[])},k=A;var I=(i,u,p)=>{let a=i+u,t=p;return(a%t+t)%t};var D=F($)`
  box-sizing: border-box;
  margin-bottom: ${W(5)};
  padding: 0 4px;
  width: 100%;

  &:last-child {
    margin-bottom: 0px;
  }

  ${U} {
    font-weight: 400;
    user-select: none;
  }
`,z=F.div`
  &:focus {
    outline: none;
  }
`,j=L.forwardRef((i,u)=>{let{allowMultiple:p=!0,className:a,disabled:t,filter:w,label:s,options:v,value:f,tabIndex:l,onBlur:r,onChange:b,onKeyDown:d}=i,n=T(null);V(u,()=>n.current);let E=T(null),[y,m]=C(!1),H=e=>v.filter(o=>e?o.label.toLowerCase().includes(e.toLowerCase()):!0),[g,K]=C(H(w)),[x,c]=C(!!f==!![]?0:g.findIndex(e=>f.includes(e.id)));R(()=>{y&&(n.current.getBoundingClientRect().bottom>window.innerHeight&&n.current.scrollIntoView(!1),n.current.getBoundingClientRect().top<0&&n.current.scrollIntoView())},[x]),R(()=>{K(H(w)),c(0)},[w,v.length]);let P=e=>{var h;let o=e.relatedTarget;o instanceof Element&&((h=o.getAttribute("data-parent"))==null?void 0:h.includes(s))||(c(0),m(!1),r&&r(e))},B=e=>{var M;let o=e.target,O=parseInt(o.getAttribute("data-idx"),10),h=k({allowMultiple:p,options:v,filteredOptions:g,currentIdx:O,previousIdx:x,shiftDown:e.shiftKey,value:f});b(h,e),c(O),(M=E.current)==null||M.focus()};return L.createElement(z,{"aria-label":s,className:a,"data-parent":s,tabIndex:t?-1:l||0,ref:E,role:"listbox",onKeyDown:S({"(?:Arrow(?:Up|Down))|End|Home|\\s":e=>{if(!t)switch(d&&d(e),e.key){case"ArrowDown":e.preventDefault(),c(I(x,1,g.length));break;case"ArrowUp":e.preventDefault(),c(I(x,-1,g.length));break;case"End":e.preventDefault(),c(g.length-1);break;case"Home":e.preventDefault(),c(0);break;case" ":case"SpaceBar":e.preventDefault(),n.current.click();break;default:}}}),onFocus:e=>{i.onFocus&&i.onFocus(e),m(!0)},onBlur:P},g.map((e,o)=>L.createElement(D,{active:!t&&y&&o===x,disabled:e.disabled||t,"data-idx":o,"data-parent":s,id:`${s}-${e.id}`,label:e.label,name:e.id,ref:o===x?n:void 0,role:"option",tabIndex:-1,value:f.includes(e.id),onChange:()=>{},onClick:B})))}),N=j;export{D as Option,N as default};
