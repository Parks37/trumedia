var $=Object.create,y=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var z=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var K=t=>y(t,"__esModule",{value:!0});var q=(t,n)=>{for(var i in n)y(t,i,{get:n[i],enumerable:!0})},G=(t,n,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of W(n))!j.call(t,r)&&r!=="default"&&y(t,r,{get:()=>n[r],enumerable:!(i=U(n,r))||i.enumerable});return t},I=t=>G(K(y(t!=null?$(z(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);K(exports);q(exports,{Option:()=>L,default:()=>T});var o=I(require("react")),R=I(require("styled-components")),P=I(require("@wedgekit/utils")),B=I(require("@wedgekit/checkbox")),k=I(require("@wedgekit/primitives"));var J=({allowMultiple:t=!0,options:n,filteredOptions:i=n,currentIdx:r,previousIdx:a,shiftDown:v,value:c})=>{if(!t)return[i[r].id];let[h,b]=[r,a].sort();return n.reduce((u,d)=>{let m=c.includes(d.id),p=i.findIndex(g=>g.id===d.id);if(typeof p!="number")return m?u.concat(d.id):u;if(v){let g=h<=p&&p<=b;if(m||g)return u.concat(d.id)}let s=r===p;return(m||s)&&!(m&&s)?u.concat(d.id):u},[])},M=J;var O=(t,n,i)=>{let r=t+n,a=i;return(r%a+a)%a};var L=(0,R.default)(B.default)`
  box-sizing: border-box;
  margin-bottom: ${(0,k.getBasePx)(5)};
  padding: 0 4px;
  width: 100%;

  &:last-child {
    margin-bottom: 0px;
  }

  ${k.Label} {
    font-weight: 400;
    user-select: none;
  }
`,Q=R.default.div`
  &:focus {
    outline: none;
  }
`,X=o.default.forwardRef((t,n)=>{let{allowMultiple:i=!0,className:r,disabled:a,filter:v,label:c,options:h,value:b,tabIndex:u,onBlur:d,onChange:m,onKeyDown:p}=t,s=(0,o.useRef)(null);(0,o.useImperativeHandle)(n,()=>s.current);let C=(0,o.useRef)(null),[D,g]=(0,o.useState)(!1),F=e=>h.filter(l=>e?l.label.toLowerCase().includes(e.toLowerCase()):!0),[x,A]=(0,o.useState)(F(v)),[w,f]=(0,o.useState)(!!b==!![]?0:x.findIndex(e=>b.includes(e.id)));(0,o.useEffect)(()=>{D&&(s.current.getBoundingClientRect().bottom>window.innerHeight&&s.current.scrollIntoView(!1),s.current.getBoundingClientRect().top<0&&s.current.scrollIntoView())},[w]),(0,o.useEffect)(()=>{A(F(v)),f(0)},[v,h.length]);let V=e=>{var E;let l=e.relatedTarget;l instanceof Element&&((E=l.getAttribute("data-parent"))==null?void 0:E.includes(c))||(f(0),g(!1),d&&d(e))},S=e=>{var N;let l=e.target,H=parseInt(l.getAttribute("data-idx"),10),E=M({allowMultiple:i,options:h,filteredOptions:x,currentIdx:H,previousIdx:w,shiftDown:e.shiftKey,value:b});m(E,e),f(H),(N=C.current)==null||N.focus()};return o.default.createElement(Q,{"aria-label":c,className:r,"data-parent":c,tabIndex:a?-1:u||0,ref:C,role:"listbox",onKeyDown:(0,P.handleKeyEvent)({"(?:Arrow(?:Up|Down))|End|Home|\\s":e=>{if(!a)switch(p&&p(e),e.key){case"ArrowDown":e.preventDefault(),f(O(w,1,x.length));break;case"ArrowUp":e.preventDefault(),f(O(w,-1,x.length));break;case"End":e.preventDefault(),f(x.length-1);break;case"Home":e.preventDefault(),f(0);break;case" ":case"SpaceBar":e.preventDefault(),s.current.click();break;default:}}}),onFocus:e=>{t.onFocus&&t.onFocus(e),g(!0)},onBlur:V},x.map((e,l)=>o.default.createElement(L,{active:!a&&D&&l===w,disabled:e.disabled||a,"data-idx":l,"data-parent":c,id:`${c}-${e.id}`,label:e.label,name:e.id,ref:l===w?s:void 0,role:"option",tabIndex:-1,value:b.includes(e.id),onChange:()=>{},onClick:S})))}),T=X;
